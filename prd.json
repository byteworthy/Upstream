{
  "branchName": "milestone-02-specialty-modules",
  "context": {
    "milestone": "02",
    "milestoneName": "Specialty Modules",
    "milestoneGoal": "Build specialty-specific intelligence modules for Dialysis (MA variance), ABA (unit tracking), PT/OT (8-minute rule), Imaging (PA requirements), and Home Health (PDGM validation).",
    "dependsOn": [
      "Milestone 1: Core Scoring Engine",
      "Authorization model with specialty_metadata (from Month 1)"
    ],
    "priorArtifacts": [
      "upstream/models.py - Authorization with SERVICE_TYPE_CHOICES (ABA, PT, OT, IMAGING, HOME_HEALTH, DIALYSIS)",
      "upstream/models.py - RiskBaseline for historical denial tracking",
      "upstream/services/scoring.py - RiskScoringService from Milestone 1"
    ],
    "successCriteria": [
      "Dialysis MA variance alerts trigger when payment < 85% of traditional Medicare",
      "ABA authorization unit tracking with exhaustion projection",
      "PT/OT 8-minute rule validation catches billing errors",
      "Imaging PA requirements database integrated",
      "Home Health PDGM grouper validates billing accuracy",
      "All specialty modules integrated into ClaimScore calculation"
    ],
    "qualityGates": [
      "python manage.py check",
      "python manage.py test upstream -v 2",
      "python manage.py test upstream.tests_specialty -v 2"
    ]
  },
  "userStories": [
    {
      "id": 1,
      "title": "Create DialysisMABaseline model for Medicare baselines",
      "description": "Create model to store traditional Medicare payment baselines for dialysis CPT codes. Used to compare MA payer payments.",
      "acceptanceCriteria": [
        "DialysisMABaseline model created with: cpt, average_payment, sample_size, last_updated",
        "Migration created and applied",
        "Composite index on cpt for fast lookups",
        "Admin interface registered"
      ],
      "files": [
        "upstream/products/dialysis/models.py",
        "upstream/products/dialysis/migrations/0001_initial.py",
        "upstream/admin.py"
      ],
      "passes": true
    },
    {
      "id": 2,
      "title": "Create DialysisMAService for variance detection",
      "description": "Create service that detects when MA payer payments are significantly below traditional Medicare baseline.",
      "acceptanceCriteria": [
        "DialysisMAService class created",
        "detect_variance(claim) method compares paid_amount to baseline",
        "Creates AlertEvent when ratio < 0.85",
        "Calculates projected annual revenue loss",
        "Handles missing baseline gracefully"
      ],
      "files": [
        "upstream/products/dialysis/services.py"
      ],
      "passes": true
    },
    {
      "id": 3,
      "title": "Create MA payer list and variance thresholds",
      "description": "Create configuration for known Medicare Advantage payers and variance alert thresholds.",
      "acceptanceCriteria": [
        "MA_PAYER_LIST constant with major MA payers",
        "VARIANCE_THRESHOLD setting (default 0.85)",
        "HIGH_VARIANCE_THRESHOLD for critical alerts (0.70)",
        "Configuration loadable from settings or database"
      ],
      "files": [
        "upstream/products/dialysis/constants.py"
      ],
      "passes": true
    },
    {
      "id": 4,
      "title": "Write tests for DialysisMAService",
      "description": "Create comprehensive tests for dialysis MA variance detection.",
      "acceptanceCriteria": [
        "Test variance detection at various payment ratios",
        "Test alert creation with correct severity",
        "Test revenue loss calculation",
        "Test handling of missing baselines",
        "Coverage > 90%"
      ],
      "files": [
        "upstream/products/dialysis/tests.py"
      ],
      "passes": true
    },
    {
      "id": 5,
      "title": "Create ABAAuthorizationTracker model",
      "description": "Create model to track ABA authorization unit consumption and exhaustion projections.",
      "acceptanceCriteria": [
        "ABAAuthorizationTracker model with: authorization FK, units_used, units_remaining, weekly_usage_rate, projected_exhaustion_date",
        "Migration created and applied",
        "Unique constraint on authorization",
        "Methods for updating usage"
      ],
      "files": [
        "upstream/products/aba/models.py",
        "upstream/migrations/0028_aba_authorization_tracker.py"
      ],
      "passes": true
    },
    {
      "id": 6,
      "title": "Create ABAAuthorizationService for unit tracking",
      "description": "Create service that tracks ABA unit consumption from claims and projects authorization exhaustion.",
      "acceptanceCriteria": [
        "ABAAuthorizationService class created",
        "track_units(claim) updates units_used from claim procedure_count",
        "project_exhaustion() calculates date based on weekly usage rate",
        "Triggers alert at 90% utilization",
        "Handles multiple active authorizations"
      ],
      "files": [
        "upstream/products/aba/services.py"
      ],
      "passes": true
    },
    {
      "id": 7,
      "title": "Create ABA re-auth deadline alerts",
      "description": "Implement alert system for ABA authorization expiration: 30-day, 14-day, and 3-day notices.",
      "acceptanceCriteria": [
        "check_auth_expiration() method in ABAAuthorizationService",
        "Alert at 30 days: severity=MEDIUM",
        "Alert at 14 days: severity=HIGH",
        "Alert at 3 days: severity=CRITICAL",
        "Tracks last_alert_sent to prevent duplicates"
      ],
      "files": [
        "upstream/products/aba/services.py"
      ],
      "passes": true
    },
    {
      "id": 8,
      "title": "Create BCBA credential expiration tracking",
      "description": "Track supervising clinician credentials in Authorization.specialty_metadata and alert before expiration.",
      "acceptanceCriteria": [
        "specialty_metadata schema includes: bcba_required, credential_expiration, credential_type",
        "check_credential_expiration() alerts at 60/30/14 days",
        "Severity escalates as deadline approaches",
        "Integration with ABAAuthorizationService"
      ],
      "files": [
        "upstream/products/aba/services.py"
      ],
      "passes": true
    },
    {
      "id": 9,
      "title": "Write tests for ABAAuthorizationService",
      "description": "Create comprehensive tests for ABA authorization tracking.",
      "acceptanceCriteria": [
        "Test unit consumption tracking",
        "Test exhaustion projection accuracy",
        "Test re-auth alert thresholds",
        "Test credential expiration alerts",
        "Test duplicate alert prevention"
      ],
      "files": [
        "upstream/products/aba/tests.py"
      ],
      "passes": true
    },
    {
      "id": 10,
      "title": "Create TIME_BASED_CPTS constant for PT/OT",
      "description": "Define time-based CPT codes with their standard minute values for 8-minute rule validation.",
      "acceptanceCriteria": [
        "TIME_BASED_CPTS dictionary: {'97110': 15, '97112': 15, '97140': 15, ...}",
        "30+ common PT/OT CPT codes included",
        "Comments documenting code descriptions",
        "Loadable from settings for customization"
      ],
      "files": [
        "upstream/products/ptot/constants.py"
      ],
      "passes": true
    },
    {
      "id": 11,
      "title": "Create PTOTService with 8-minute rule validation",
      "description": "Create service that validates PT/OT claims against the 8-minute rule for time-based billing.",
      "acceptanceCriteria": [
        "PTOTService class created",
        "validate_8_minute_rule(claim) calculates expected units from total minutes",
        "8-minute rule: 8-22min=1 unit, 23-37min=2 units, etc.",
        "Creates alert when billed_units != expected_units",
        "Handles non-time-based CPTs correctly"
      ],
      "files": [
        "upstream/products/ptot/services.py"
      ],
      "passes": true
    },
    {
      "id": 12,
      "title": "Create KX threshold monitoring for therapy cap",
      "description": "Detect when patients exceed the therapy cap ($2,410 for 2025) and require KX modifier.",
      "acceptanceCriteria": [
        "THERAPY_CAP_THRESHOLD setting (configurable annually)",
        "check_kx_threshold() calculates patient YTD charges",
        "Creates alert if cap exceeded and KX modifier missing",
        "Severity=CRITICAL for missing KX",
        "Handles calendar year boundary"
      ],
      "files": [
        "upstream/products/ptot/services.py"
      ],
      "passes": true
    },
    {
      "id": 13,
      "title": "Write tests for PTOTService",
      "description": "Create comprehensive tests for PT/OT billing validation.",
      "acceptanceCriteria": [
        "Test 8-minute rule calculations at various minute values",
        "Test alert creation for over/under billing",
        "Test KX threshold detection",
        "Test YTD charge calculation",
        "Coverage > 90%"
      ],
      "files": [
        "upstream/products/ptot/tests.py"
      ],
      "passes": true
    },
    {
      "id": 14,
      "title": "Create ImagingPARequirement model",
      "description": "Create model to store prior authorization requirements by payer and CPT code for imaging procedures.",
      "acceptanceCriteria": [
        "ImagingPARequirement model: payer, cpt, pa_required, rbm_provider (eviCore/AIM), effective_date",
        "Migration created and applied",
        "Composite index on (payer, cpt)",
        "Bulk import capability for PA requirements CSV"
      ],
      "files": [
        "upstream/products/imaging/models.py",
        "upstream/products/imaging/migrations/0001_initial.py"
      ],
      "passes": true
    },
    {
      "id": 15,
      "title": "Create ImagingPAService for PA requirement checking",
      "description": "Create service that validates imaging claims have required prior authorization.",
      "acceptanceCriteria": [
        "ImagingPAService class created",
        "check_pa_required(claim) looks up requirement by payer+cpt",
        "Verifies active Authorization exists for claim",
        "Creates CRITICAL alert if PA required but not obtained",
        "Includes RBM provider in alert for context"
      ],
      "files": [
        "upstream/products/imaging/services.py"
      ],
      "passes": true
    },
    {
      "id": 16,
      "title": "Create imaging medical necessity documentation validation",
      "description": "Validate that imaging claims have required medical necessity documentation in specialty_metadata.",
      "acceptanceCriteria": [
        "specialty_metadata schema: has_medical_necessity_docs, clinical_justification, icd10_codes",
        "validate_documentation(claim) checks required fields",
        "Creates alert if documentation incomplete for PA-required claims",
        "Integrates with red-line detection in scoring"
      ],
      "files": [
        "upstream/products/imaging/services.py"
      ],
      "passes": true
    },
    {
      "id": 17,
      "title": "Write tests for ImagingPAService",
      "description": "Create comprehensive tests for imaging PA validation.",
      "acceptanceCriteria": [
        "Test PA requirement lookup",
        "Test authorization verification",
        "Test alert creation for missing PA",
        "Test documentation validation",
        "Test bulk import functionality"
      ],
      "files": [
        "upstream/products/imaging/tests.py"
      ],
      "passes": true
    },
    {
      "id": 18,
      "title": "Create PDGM_GROUPS constant for home health",
      "description": "Define PDGM grouper mapping for 50 most common clinical/functional/timing combinations.",
      "acceptanceCriteria": [
        "PDGM_GROUPS dictionary mapping (timing, clinical, functional, comorbidity) to group code",
        "50+ common combinations covered",
        "Comments documenting CMS source",
        "Lookup function for group determination"
      ],
      "files": [
        "upstream/products/homehealth/constants.py"
      ],
      "passes": true
    },
    {
      "id": 19,
      "title": "Create HomeHealthService for PDGM validation",
      "description": "Create service that validates home health claims against PDGM grouper logic.",
      "acceptanceCriteria": [
        "HomeHealthService class created",
        "validate_pdgm_grouping(claim) extracts timing/clinical/functional/comorbidity from specialty_metadata",
        "Compares expected vs billed PDGM group",
        "Creates HIGH alert on mismatch",
        "Handles missing OASIS data gracefully"
      ],
      "files": [
        "upstream/products/homehealth/services.py"
      ],
      "passes": true
    },
    {
      "id": 20,
      "title": "Create Face-to-Face and NOA deadline tracking",
      "description": "Validate F2F assessment timing and NOA submission deadlines for home health.",
      "acceptanceCriteria": [
        "specialty_metadata includes: f2f_completed, f2f_date, start_of_care_date, noa_submitted_date",
        "validate_f2f_timing() checks F2F within 5 days of SOC",
        "check_noa_deadline() alerts when NOA due in <2 days",
        "Severity escalates as deadlines approach"
      ],
      "files": [
        "upstream/products/homehealth/services.py"
      ],
      "passes": true
    },
    {
      "id": 21,
      "title": "Write tests for HomeHealthService",
      "description": "Create comprehensive tests for home health PDGM validation.",
      "acceptanceCriteria": [
        "Test PDGM group lookup",
        "Test mismatch detection",
        "Test F2F timing validation",
        "Test NOA deadline alerts",
        "Coverage > 90%"
      ],
      "files": [
        "upstream/products/homehealth/tests.py"
      ],
      "passes": true
    },
    {
      "id": 22,
      "title": "Integrate specialty modules into ClaimScore calculation",
      "description": "Enhance RiskScoringService to include specialty-specific risk factors based on claim service_type.",
      "acceptanceCriteria": [
        "RiskScoringService routes to appropriate specialty service based on claim service_type",
        "Specialty risk factors affect overall_confidence",
        "Specialty violations trigger requires_human_review flag",
        "All specialty alerts integrate with main alert system"
      ],
      "files": [
        "upstream/services/scoring.py"
      ],
      "passes": false
    },
    {
      "id": 23,
      "title": "Create specialty module API endpoints",
      "description": "Add API endpoints for specialty-specific data and validation results.",
      "acceptanceCriteria": [
        "GET /api/v1/specialty/dialysis/baselines/ - list MA baselines",
        "GET /api/v1/specialty/aba/authorizations/ - list ABA auth tracking",
        "GET /api/v1/specialty/imaging/pa-requirements/ - list PA requirements",
        "POST /api/v1/specialty/validate/ - run specialty validation for claim",
        "OpenAPI documentation complete"
      ],
      "files": [
        "upstream/api/views.py",
        "upstream/api/urls.py"
      ],
      "passes": false
    }
  ]
}
