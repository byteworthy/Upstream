{
  "branchName": "ralph/upstream-gaps-sprint1",
  "description": "Implement Upstream healthcare platform gaps: RPA Framework, PT/OT G-Codes, Home Health Certification Cycles",
  "userStories": [
    {
      "id": 1,
      "title": "Create RPA base module with abstract PayerPortalBase class, ReauthRequest, AppealRequest, and SubmissionResult dataclasses in upstream/automation/rpa/base.py",
      "passes": false,
      "acceptance": [
        "PayerPortalBase ABC with login(), submit_reauth_request(), submit_appeal(), check_status() methods",
        "ReauthRequest dataclass with auth_number, patient_id, payer, service_type, units_requested, utilization_report_url",
        "AppealRequest dataclass with claim_id, payer, denial_reason, appeal_letter, supporting_docs",
        "SubmissionResult dataclass with success, confirmation_number, submitted_at, payer, error_message",
        "All classes have docstrings and type hints"
      ]
    },
    {
      "id": 2,
      "title": "Create MockPayerPortal implementation in upstream/automation/rpa/mock_portal.py with simulated responses",
      "passes": false,
      "acceptance": [
        "MockPayerPortal extends PayerPortalBase",
        "login() returns True with optional fail_rate simulation",
        "submit_reauth_request() generates MOCK-XXXXXXXX confirmation numbers",
        "submit_appeal() generates APPEAL-XXXXXXXX confirmation numbers",
        "check_status() returns simulated status dict",
        "Configurable fail_rate for testing error handling",
        "Simulates processing delay (0.1s) for realistic testing"
      ]
    },
    {
      "id": 3,
      "title": "Create RPA __init__.py with exports and portal registry function get_portal_for_payer()",
      "passes": false,
      "acceptance": [
        "__init__.py exports PayerPortalBase, MockPayerPortal, ReauthRequest, AppealRequest, SubmissionResult",
        "get_portal_for_payer(payer: str) function returns appropriate portal instance",
        "Default to MockPayerPortal when no real integration exists",
        "Registry pattern allows easy addition of real payer integrations"
      ]
    },
    {
      "id": 4,
      "title": "Create comprehensive tests for RPA module in upstream/automation/rpa/tests.py",
      "passes": false,
      "acceptance": [
        "Test PayerPortalBase cannot be instantiated directly",
        "Test MockPayerPortal.login() success and failure modes",
        "Test MockPayerPortal.submit_reauth_request() returns valid SubmissionResult",
        "Test MockPayerPortal.submit_appeal() returns valid SubmissionResult",
        "Test MockPayerPortal.check_status() returns expected dict structure",
        "Test fail_rate parameter produces failures at expected rate",
        "Test get_portal_for_payer() returns correct portal types",
        "All tests pass with pytest"
      ]
    },
    {
      "id": 5,
      "title": "Integrate RPA with rules_engine.py - add _execute_rpa_action method to RulesEngine",
      "passes": false,
      "acceptance": [
        "RulesEngine._execute_action() routes to _execute_rpa_action() for rpa action types",
        "_execute_rpa_action() gets portal via get_portal_for_payer()",
        "Supports submit_reauth and submit_appeal action types",
        "Logs all RPA actions to ExecutionLog with confirmation numbers",
        "Handles portal failures gracefully with escalation",
        "Tests verify RPA integration works end-to-end"
      ]
    },
    {
      "id": 6,
      "title": "Create PTOTFunctionalLimitation model in upstream/products/ptot/models.py",
      "passes": false,
      "acceptance": [
        "Model with customer FK, patient_id, limitation_category (7 choices)",
        "G-code fields: current_gcode, goal_gcode, discharge_gcode",
        "Severity modifier fields: current_severity, goal_severity, discharge_severity",
        "Tracking fields: evaluation_date, last_reported_date, visit_count_since_report, discharge_date",
        "Status field with ACTIVE, DISCHARGED choices",
        "CustomerScopedManager for tenant isolation",
        "Migration created and applied"
      ]
    },
    {
      "id": 7,
      "title": "Create PTOTProgressReport model in upstream/products/ptot/models.py for tracking 10-visit G-code reporting",
      "passes": false,
      "acceptance": [
        "Model with functional_limitation FK",
        "report_date, visit_number, reporting_type (EVALUATION, PROGRESS, DISCHARGE)",
        "gcodes_reported JSONField for codes submitted",
        "Indexes on (customer, patient_id) and (functional_limitation, report_date)",
        "Migration created and applied"
      ]
    },
    {
      "id": 8,
      "title": "Add G-code constants to upstream/products/ptot/constants.py",
      "passes": false,
      "acceptance": [
        "FUNCTIONAL_LIMITATION_CATEGORIES dict with 7 categories (MOBILITY, CHANGING_POSITION, CARRYING, SELF_CARE, OTHER_PT, OTHER_SLP, SWALLOWING)",
        "GCODE_RANGES dict mapping categories to valid G-code ranges (G8978-G8999 etc)",
        "SEVERITY_MODIFIERS list (CH through CN)",
        "PROGRESS_REPORT_VISIT_INTERVAL = 10",
        "REPORTING_TYPES tuple (EVALUATION, PROGRESS, DISCHARGE)",
        "CPT_CODES_REQUIRING_GCODES list for PT/OT evaluation codes"
      ]
    },
    {
      "id": 9,
      "title": "Add validate_gcode_reporting() method to PTOTService in upstream/products/ptot/services.py",
      "passes": false,
      "acceptance": [
        "Method accepts ClaimRecord and returns GCodeValidationResult dataclass",
        "Detects missing G-codes at evaluation visits",
        "Detects missing G-codes at discharge visits",
        "Validates G-code format and category matching",
        "Returns valid=True/False with issue type and message"
      ]
    },
    {
      "id": 10,
      "title": "Add check_progress_report_due() method to PTOTService for 10th visit tracking",
      "passes": false,
      "acceptance": [
        "Method accepts customer and patient_id",
        "Queries PTOTFunctionalLimitation for active records",
        "Returns True if visit_count_since_report >= PROGRESS_REPORT_VISIT_INTERVAL",
        "Returns list of due functional limitations with days until overdue"
      ]
    },
    {
      "id": 11,
      "title": "Add G-code alert generation methods to PTOTService",
      "passes": false,
      "acceptance": [
        "create_gcode_missing_alert() creates AlertEvent with evidence payload",
        "create_progress_report_due_alert() creates AlertEvent with patient and visit info",
        "create_functional_limitation_incomplete_alert() for incomplete G-code sets",
        "All alerts integrate with existing alert system",
        "Alert types: ptot_gcode_missing, ptot_progress_report_due, ptot_functional_limitation_incomplete"
      ]
    },
    {
      "id": 12,
      "title": "Create comprehensive tests for PT/OT G-code validation in upstream/products/ptot/tests.py",
      "passes": false,
      "acceptance": [
        "Test PTOTFunctionalLimitation model creation and validation",
        "Test PTOTProgressReport model creation",
        "Test validate_gcode_reporting() detects missing G-codes",
        "Test validate_gcode_reporting() passes valid claims",
        "Test check_progress_report_due() returns correct results",
        "Test alert generation methods create proper AlertEvents",
        "90%+ code coverage on new G-code functionality"
      ]
    },
    {
      "id": 13,
      "title": "Add CertificationCycle model to upstream/products/homehealth/models.py",
      "passes": false,
      "acceptance": [
        "Model with customer FK, episode FK (HomeHealthEpisode)",
        "cycle_number IntegerField, cycle_start DateField, cycle_end DateField (start + 60 days)",
        "Recert fields: physician_recert_signed BooleanField, physician_recert_date DateField",
        "F2F fields: f2f_completed BooleanField, f2f_date DateField",
        "Status choices: ACTIVE, PENDING_RECERT, RECERTIFIED, DISCHARGED, EXPIRED",
        "CustomerScopedManager for tenant isolation",
        "Migration created and applied"
      ]
    },
    {
      "id": 14,
      "title": "Add certification cycle tracking methods to HomeHealthService",
      "passes": false,
      "acceptance": [
        "create_certification_cycle() creates new cycle from episode",
        "get_active_cycles() returns cycles needing attention",
        "check_certification_deadlines() returns cycles with alerts due",
        "calculate_days_until_deadline() returns days remaining",
        "mark_recertified() updates cycle status and creates new cycle"
      ]
    },
    {
      "id": 15,
      "title": "Add certification cycle alert generation to HomeHealthService",
      "passes": false,
      "acceptance": [
        "generate_certification_alerts() checks all active cycles",
        "Creates INFO alert at 45 days before deadline",
        "Creates MEDIUM alert at 30 days before deadline",
        "Creates HIGH alert at 21 days before deadline",
        "Creates CRITICAL alert at 14 days before deadline",
        "Alerts include cycle info, patient info, required actions"
      ]
    },
    {
      "id": 16,
      "title": "Create comprehensive tests for Home Health certification cycles",
      "passes": false,
      "acceptance": [
        "Test CertificationCycle model creation and validation",
        "Test create_certification_cycle() creates proper cycles",
        "Test check_certification_deadlines() returns correct cycles",
        "Test alert generation at 45/30/21/14 day thresholds",
        "Test mark_recertified() transitions cycle correctly",
        "90%+ code coverage on certification cycle functionality"
      ]
    },
    {
      "id": 17,
      "title": "Run full test suite and verify all new features integrate correctly",
      "passes": false,
      "acceptance": [
        "python manage.py test upstream -v 2 passes",
        "All RPA tests pass",
        "All PT/OT G-code tests pass",
        "All Home Health certification tests pass",
        "No regressions in existing tests",
        "Coverage report shows 90%+ on new code"
      ]
    }
  ]
}
