---
phase: 07-frontend-unit-tests
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/pages/__tests__/Dashboard.test.tsx
autonomous: true

must_haves:
  truths:
    - "SpecialtyWidgets renders widget cards only for enabled specialties"
    - "SpecialtyWidgets shows correct labels for each specialty"
    - "SpecialtyWidgets shows nothing when no specialties enabled"
    - "SpecialtyWidgets shows nothing while loading"
    - "Dashboard renders core metrics cards"
  artifacts:
    - path: "frontend/src/pages/__tests__/Dashboard.test.tsx"
      provides: "Dashboard page tests focusing on SpecialtyWidgets"
      min_lines: 100
  key_links:
    - from: "Dashboard.test.tsx"
      to: "CustomerContext"
      via: "fetch mock"
      pattern: "globalThis.*fetch.*vi\\.fn"
    - from: "Dashboard.test.tsx"
      to: "dashboardApi"
      via: "API mock"
      pattern: "vi\\.mock.*lib/api"
---

<objective>
Create unit tests for Dashboard page focusing on the SpecialtyWidgets conditional rendering.

Purpose: Validate that specialty widget cards only appear for enabled specialties, showing the correct specialty-specific information.

Output: Test file covering SpecialtyWidgets component behavior and basic Dashboard rendering.
</objective>

<execution_context>
@/home/codespace/.claude/get-shit-done/workflows/execute-plan.md
@/home/codespace/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-frontend-unit-tests/07-RESEARCH.md

# Source file to test
@frontend/src/pages/Dashboard.tsx

# Pattern reference
@frontend/src/contexts/__tests__/CustomerContext.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Dashboard SpecialtyWidgets tests</name>
  <files>frontend/src/pages/__tests__/Dashboard.test.tsx</files>
  <action>
Create comprehensive tests for the SpecialtyWidgets component within Dashboard page.

Test cases to implement:

SpecialtyWidgets tests:
1. Shows nothing while customer data is loading
2. Shows nothing when no specialties are enabled (empty enabled_specialties array)
3. Shows "Specialty Modules" heading when at least one specialty enabled
4. Renders Dialysis widget card when DIALYSIS is enabled
5. Renders ABA Therapy widget card when ABA is enabled
6. Renders Imaging PA widget card when IMAGING is enabled
7. Renders Home Health widget card when HOME_HEALTH is enabled
8. Renders PT/OT widget card when PTOT is enabled
9. Shows multiple widget cards when multiple specialties enabled
10. Does not render disabled specialty widgets

Dashboard core tests:
11. Renders Dashboard title
12. Renders date range selector buttons (7d, 30d, 90d)
13. Renders metric cards (Total Claims, Claims This Period, Denial Rate, Average Score)
14. Shows loading state initially

Mock both CustomerContext (via fetch) and dashboardApi for metrics data.

```typescript
// Mock dashboardApi
vi.mock('@/lib/api', () => ({
  dashboardApi: {
    getMetrics: vi.fn().mockResolvedValue({
      total_claims: 12847,
      claims_last_30_days: 4532,
      denial_rate: 4.2,
      average_score: 87.3,
      tier_distribution: { tier_1: 3200, tier_2: 980, tier_3: 352 },
      recent_alerts: [],
    }),
  },
}));
```

Use text matchers like `screen.getByText('Dialysis')` for widget cards and `screen.getByText('Specialty Modules')` for section heading.
  </action>
  <verify>Run `cd /workspaces/codespaces-django/frontend && npm test -- --run src/pages/__tests__/Dashboard.test.tsx` and confirm all tests pass</verify>
  <done>14 test cases pass covering SpecialtyWidgets conditional rendering (10) and Dashboard core elements (4)</done>
</task>

<task type="auto">
  <name>Task 2: Run full test suite and verify coverage</name>
  <files>None (verification only)</files>
  <action>
Run the complete frontend test suite to verify all new tests pass alongside existing tests.

Execute:
```bash
cd /workspaces/codespaces-django/frontend
npm test -- --run
```

Check that:
1. All new test files pass (SpecialtyRoute, Sidebar, Settings, Dashboard)
2. Existing tests still pass (CustomerContext.test.tsx - 14 tests)
3. No console errors or warnings about missing providers

Document the test count for each new file:
- SpecialtyRoute.test.tsx: X tests
- Sidebar.test.tsx: X tests
- Settings.test.tsx: X tests
- Dashboard.test.tsx: X tests
- Total new tests: X
  </action>
  <verify>Run `cd /workspaces/codespaces-django/frontend && npm test -- --run` and confirm all tests pass with 0 failures</verify>
  <done>Full test suite passes. New specialty module tests add 45+ tests covering SpecialtyRoute, Sidebar, Settings, and Dashboard components.</done>
</task>

</tasks>

<verification>
```bash
cd /workspaces/codespaces-django/frontend
npm test -- --run
```

All tests should pass. The new test files should integrate cleanly with existing test infrastructure.
</verification>

<success_criteria>
- Dashboard.test.tsx has 14+ passing test cases
- SpecialtyWidgets conditional rendering fully tested
- Full test suite passes (no regressions)
- All 5 success criteria from Phase 7 requirements validated:
  1. CustomerContext tests validate enableSpecialty, disableSpecialty, hasSpecialty
  2. SpecialtyRoute tests confirm redirect behavior
  3. Settings tests validate toggle enable/disable functionality
  4. Dashboard tests verify conditional rendering based on enabled specialties
  5. Sidebar tests confirm dynamic navigation updates
</success_criteria>

<output>
After completion, create `.planning/phases/07-frontend-unit-tests/07-03-SUMMARY.md`
</output>
