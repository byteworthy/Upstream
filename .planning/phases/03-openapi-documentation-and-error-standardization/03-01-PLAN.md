---
phase: 03-openapi-documentation-and-error-standardization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - upstream/settings/base.py
  - upstream/api/views.py
  - upstream/api/serializers.py
autonomous: true

must_haves:
  truths:
    - "OpenAPI schema at /api/schema/ includes all endpoints with summaries and descriptions"
    - "Swagger UI at /api/schema/swagger-ui/ displays organized API documentation with tags"
    - "Each ViewSet action (list, retrieve, create, update, custom) has tag assignment"
    - "Documentation shows all filter parameters for each endpoint"
  artifacts:
    - path: "upstream/settings/base.py"
      provides: "Enhanced SPECTACULAR_SETTINGS with tags and server configuration"
      contains: "TAGS"
    - path: "upstream/api/views.py"
      provides: "All ViewSets decorated with @extend_schema_view"
      min_lines: 1800
    - path: "upstream/api/serializers.py"
      provides: "Serializers with examples via @extend_schema_serializer"
      min_lines: 300
  key_links:
    - from: "upstream/api/views.py"
      to: "drf_spectacular.utils"
      via: "@extend_schema_view and @extend_schema decorators"
      pattern: "@extend_schema"
    - from: "upstream/settings/base.py"
      to: "SPECTACULAR_SETTINGS"
      via: "Tags configuration"
      pattern: "TAGS.*:.*\\["
---

<objective>
Enhance OpenAPI documentation by adding comprehensive @extend_schema decorators to all ViewSets and configuring SPECTACULAR_SETTINGS with proper tags and organization.

Purpose: Provide complete, navigable API documentation for frontend developers and API consumers. Current SPECTACULAR_SETTINGS has minimal configuration; ViewSets lack schema decorators causing auto-generated docs to be incomplete and poorly organized.

Output: Complete OpenAPI schema with all 9 ViewSets documented, tagged, and organized. Swagger UI displays clear navigation by resource type (Customers, Claims, Reports, etc.).
</objective>

<execution_context>
@/home/codespace/.claude/get-shit-done/workflows/execute-plan.md
@/home/codespace/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/workspaces/codespaces-django/.planning/PROJECT.md
@/workspaces/codespaces-django/.planning/ROADMAP.md
@/workspaces/codespaces-django/.planning/STATE.md
@/workspaces/codespaces-django/.planning/phases/03-openapi-documentation-and-error-standardization/03-CONTEXT.md
@/workspaces/codespaces-django/.planning/phases/03-openapi-documentation-and-error-standardization/03-RESEARCH.md
@/workspaces/codespaces-django/.planning/phases/02-api-pagination-and-filtering/02-02-SUMMARY.md

Research findings:
- drf-spectacular 0.27.2 already installed and configured
- Current SPECTACULAR_SETTINGS minimal (title, description, version only)
- ViewSets in upstream/api/views.py: CustomerViewSet, SettingsViewSet, UploadViewSet, ClaimRecordViewSet, ReportRunViewSet, DriftEventViewSet, PayerMappingViewSet, CPTGroupMappingViewSet, AlertEventViewSet
- Phase 2 added DjangoFilterBackend - filter parameters should auto-document
- Existing imports show drf_spectacular.utils already used minimally
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure SPECTACULAR_SETTINGS with comprehensive tags and metadata</name>
  <files>upstream/settings/base.py</files>
  <action>
Enhance SPECTACULAR_SETTINGS in upstream/settings/base.py with comprehensive configuration:

1. Add TAGS list defining operation groups:
   - Customers: Customer management
   - Settings: Customer settings and configuration
   - Uploads: File upload processing
   - Claims: Claim record operations
   - Reports: Report generation and retrieval
   - Drift Events: Drift detection alerts
   - Payer Mappings: Payer mapping configuration
   - CPT Groups: CPT group mappings
   - Alerts: Alert events and feedback

2. Add SERVERS list:
   - Production: https://api.upstream.example.com (placeholder)
   - Development: http://localhost:8000

3. Add SECURITY configuration for JWT Bearer authentication:
   - SECURITY: [{"Bearer": []}]

4. Keep existing settings (TITLE, DESCRIPTION, VERSION, SERVE_INCLUDE_SCHEMA)

5. Add POSTPROCESSING_HOOKS: [] (for future error response schema fixes)

6. Add COMPONENT_SPLIT_REQUEST: True (separate request/response schemas)

7. Keep note about status enum conflicts (StatusB74Enum, StatusDcfEnum)
  </action>
  <verify>
1. Run: python manage.py spectacular --validate
2. Verify: No errors, warnings about tags or security definitions
3. Check: SPECTACULAR_SETTINGS contains 9 tag definitions
  </verify>
  <done>SPECTACULAR_SETTINGS configured with 9 tags, server URLs, security scheme, and component settings. Schema validation passes with no errors.</done>
</task>

<task type="auto">
  <name>Task 2: Add @extend_schema_view decorators to all ViewSets</name>
  <files>upstream/api/views.py</files>
  <action>
Apply @extend_schema_view decorators to all 9 ViewSets in upstream/api/views.py:

**For each ViewSet, document:**
- list: summary, tags, responses={200, 401, 403, 429}
- retrieve: summary, tags, responses={200, 401, 403, 404, 429}
- create: summary, tags (if applicable), responses={201, 400, 401, 403, 429}
- update: summary, tags (if applicable), responses={200, 400, 401, 403, 404, 429}
- partial_update: summary, tags (if applicable), responses={200, 400, 401, 403, 404, 429}
- destroy: summary, tags (if applicable), responses={204, 401, 403, 404, 429}

**Custom actions (@action decorators):**
- Add @extend_schema decorator to each custom action method
- Document: summary, description, tags, responses
- Custom actions include: payer_summary, active, feedback, dashboard (check views.py for all)

**Tag assignments:**
- CustomerViewSet: ["Customers"]
- SettingsViewSet: ["Settings"]
- UploadViewSet: ["Uploads"]
- ClaimRecordViewSet: ["Claims"]
- ReportRunViewSet: ["Reports"]
- DriftEventViewSet: ["Drift Events"]
- PayerMappingViewSet: ["Payer Mappings"]
- CPTGroupMappingViewSet: ["CPT Groups"]
- AlertEventViewSet: ["Alerts"]

**Error responses:**
Use OpenApiTypes.OBJECT for all error responses (standardized in Plan 02).
Include 429 (throttled) on all endpoints since throttling is global.

**Existing decorators:**
Some minimal @extend_schema usage already exists - enhance, don't duplicate.
  </action>
  <verify>
1. Run: python manage.py spectacular --validate
2. Verify: No errors about missing schemas
3. Run: python manage.py spectacular --file schema.yaml
4. Check schema.yaml: All 9 ViewSet operations present with tags
5. Count: grep -c "tags:" schema.yaml should show significant increase
  </verify>
  <done>All 9 ViewSets decorated with @extend_schema_view. Every action has summary, description, tags, and error responses documented. Schema generation produces complete documentation.</done>
</task>

<task type="auto">
  <name>Task 3: Add request/response examples to key serializers</name>
  <files>upstream/api/serializers.py</files>
  <action>
Add @extend_schema_serializer with OpenApiExample to commonly-used serializers:

**Priority serializers (add 1-2 examples each):**
1. ClaimRecordSerializer - approved claim, denied claim
2. DriftEventSerializer - high severity event, low severity event
3. ReportRunSerializer - completed report, running report
4. UploadSerializer - successful upload, validation errors
5. AlertEventSerializer - triggered alert, resolved alert

**Example format:**
```python
from drf_spectacular.utils import extend_schema_serializer, OpenApiExample

@extend_schema_serializer(
    examples=[
        OpenApiExample(
            name="Approved claim",
            description="Example of a typical approved claim record",
            value={
                "id": 123,
                "claim_number": "CLM-2026-00001",
                "status": "approved",
                "allowed_amount": 500.00,
                ...
            }
        ),
        OpenApiExample(
            name="Denied claim",
            description="Example of a denied claim record",
            value={...}
        ),
    ]
)
class ClaimRecordSerializer(serializers.ModelSerializer):
    ...
```

Use realistic field values based on model definitions.
Keep examples concise but representative.
  </action>
  <verify>
1. Run: python manage.py spectacular --file schema.yaml
2. Check schema.yaml contains "examples:" sections for decorated serializers
3. Verify: grep -A 10 "ClaimRecordSerializer" schema.yaml shows example data
4. Run: python manage.py test upstream.tests_api -k serializer (if tests exist)
  </verify>
  <done>5 key serializers decorated with @extend_schema_serializer containing realistic request/response examples. OpenAPI schema includes example data for common use cases.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. OpenAPI schema generation:
   - Run: python manage.py spectacular --validate
   - Verify: Zero errors, zero critical warnings
   - Run: python manage.py spectacular --file /tmp/schema.yaml
   - Check: File contains all 9 ViewSets with tags

2. Schema completeness:
   - Count tags: grep -c "tags:" /tmp/schema.yaml
   - Verify: Each ViewSet has consistent tag assignments
   - Check: All custom actions documented

3. Documentation UI:
   - Start server: python manage.py runserver
   - Visit: http://localhost:8000/api/schema/swagger-ui/
   - Verify: Swagger UI loads, shows organized tag groups
   - Test: Each endpoint shows summary, parameters, responses

4. Filter parameter documentation:
   - Check: DjangoFilterBackend parameters auto-documented
   - Verify: list endpoints show filter parameters from Phase 2

5. Examples in schema:
   - Check: schema.yaml contains "examples:" for 5+ serializers
   - Verify: Examples have realistic field values
</verification>

<success_criteria>
1. All 9 ViewSets have @extend_schema_view decorators with complete action documentation
2. SPECTACULAR_SETTINGS configured with 9 tags, security scheme, and servers
3. python manage.py spectacular --validate returns zero errors
4. OpenAPI schema includes summaries, tags, error responses for all endpoints
5. Swagger UI displays organized API documentation with tag-based navigation
6. 5+ serializers have request/response examples in schema
</success_criteria>

<output>
After completion, create `.planning/phases/03-openapi-documentation-and-error-standardization/03-01-SUMMARY.md` using the standard summary template.

Include:
- Number of ViewSets documented
- Tag organization structure
- Schema validation results
- Example coverage (how many serializers)
- Any deviations from planned approach
</output>
